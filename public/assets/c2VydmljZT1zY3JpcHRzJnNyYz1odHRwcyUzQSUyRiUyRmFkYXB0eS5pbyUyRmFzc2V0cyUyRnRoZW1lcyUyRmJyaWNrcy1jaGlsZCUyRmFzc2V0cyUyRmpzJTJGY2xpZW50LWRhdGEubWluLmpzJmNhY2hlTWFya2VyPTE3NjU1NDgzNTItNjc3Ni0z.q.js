class AdaptyClientData{constructor(){this.cache={saveClientKeyName:"Adapty:ClientData",relevancePeriod:5,services:{ipgeolocation1:"https://api.ipgeolocation.io/ipgeo?apiKey=",ipgeolocation2:"https://api.ipgeolocation.io/ipgeo?apiKey=",ipgeolocation3:"https://api.ipgeolocation.io/ipgeo?apiKey=",ipgeolocation4:"https://api.ipgeolocation.io/ipgeo?apiKey=",abstractapi:"https://ipgeolocation.abstractapi.com/v1/?api_key="},apiKeys:{ipgeolocation1:"265ef967b847417ea8a7d6525fb8934c",ipgeolocation2:"a147dce282fe4cf9af5e707e6df5912a",ipgeolocation3:"eedf14b94bb04bcdb3ebbc0da24c491e",ipgeolocation4:"4a0c332de9d848f38fede404b33fef37",abstractapi:"eee5a91fc2764075b7556eed9baee4e7"},debug:!1},this.STATUSES={undefined:"[failed to determine]",notProvide:"[does not provide]",error:"error",success:"success",noFullData:"incomplete"},this.getClientData()}async getClientData(){let t=this.isClientDataCacheRelevance();if(t&&this.STATUSES.success===t?.status)return this.saveClientDataToWindow(t),this.setControlMethods(),this.dispatchDataReadyEvent(),t;for(let e of Object.keys(this.cache.services)){let a=this.cache.services[e]+this.cache.apiKeys[e];try{let i=await fetch(a),n=await i.json();if(n.message)continue;let s=this.exportClientData(e,n);if(this.STATUSES.success===s?.status)return this.saveClientData(s),this.dispatchDataReadyEvent(),s}catch(o){console.log("Error fetching client data: ",o)}}return null}isClientDataCacheRelevance(){let t=localStorage.getItem(this.cache.saveClientKeyName);if(!t)return!1;let e;try{e=JSON.parse(t)}catch(a){return a instanceof SyntaxError?console.error(a.name):console.error(a.message),this.deleteClientData(),!1}if(!e||!e.success)return!1;let i=new Date(e.date),n;return Math.ceil(Math.abs(new Date().getTime()-i.getTime())/864e5)-1<=this.cache.relevancePeriod-1&&e}exportClientData(t,e){let a={ip:null,location:{city:null,country:null,country_code2:null,country_flag:null,continent:null,continent_code2:null,is_eu:null,zipcode:null},coordinates:{lat:null,lon:null},currency:{name:null,code:null},timezone:{name:null,offset:null,time:null}},i={_langs:null,_call_code:null,_region:null,_is_vpn:null},n=Date.now(),s=this.STATUSES.error;switch(t){case"ipgeolocation":case"ipgeolocation0":case"ipgeolocation1":case"ipgeolocation2":case"ipgeolocation3":case"ipgeolocation4":case"ipgeolocation5":a.ip=this.assignData(e,"ip"),a.location.city=this.assignData(e,"city"),a.location.country=this.assignData(e,"country_name"),a.location.country_code2=this.assignData(e,"country_code2"),a.location.country_flag=this.assignData(e,"country_flag"),a.location.continent=this.assignData(e,"continent_name"),a.location.continent_code2=this.assignData(e,"continent_code"),a.location.is_eu=this.assignData(e,"is_eu"),a.location.zipcode=this.assignData(e,"zipcode"),a.coordinates.lat=this.assignData(e,"latitude"),a.coordinates.lon=this.assignData(e,"longitude"),a.timezone.name=this.assignData(e.time_zone,"name"),a.timezone.offset=this.assignData(e.time_zone,"offset"),a.timezone.time=this.assignData(e.time_zone,"current_time"),a.currency.name=this.assignData(e.currency,"name"),a.currency.code=this.assignData(e.currency,"code"),i._region=this.assignData(e,"state_prov"),i._call_code=this.assignData(e,"calling_code"),i._langs=this.assignData(e,"languages"),i._is_vpn=this.STATUSES.notProvide,s=this.STATUSES.success;break;case"abstractapi":a.ip=this.assignData(e,"ip_address"),a.location.city=this.assignData(e,"city"),a.location.country=this.assignData(e,"country"),a.location.country_code2=this.assignData(e,"country_code"),a.location.country_flag=this.assignData(e.flag,"svg"),a.location.continent=this.assignData(e,"continent"),a.location.continent_code2=this.assignData(e,"continent_code"),a.location.is_eu=this.assignData(e,"country_is_eu"),a.location.zipcode=this.assignData(e,"postal_code"),a.coordinates.lat=this.assignData(e,"latitude"),a.coordinates.lon=this.assignData(e,"longitude"),a.timezone.name=this.assignData(e.timezone,"name"),a.timezone.offset=this.assignData(e.timezone,"gmt_offset"),a.timezone.time=this.assignData(e.timezone,"current_time"),a.currency.name=this.assignData(e.currency,"currency_name"),a.currency.code=this.assignData(e.currency,"currency_code"),i._region=this.assignData(e,"region"),i._call_code=this.STATUSES.notProvide,i._langs=this.STATUSES.notProvide,i._is_vpn=this.assignData(e.security,"is_vpn"),s=this.STATUSES.success;break;default:s=((t,e)=>{for(let a in t)if("object"==typeof t[a]&&null!==t[a])for(let i in t[a])t[a][i]=this.STATUSES.undefined;else t[a]=this.STATUSES.undefined;for(let n in e)e[n]=this.STATUSES.undefined;return this.STATUSES.error})(a,i)}s=((t,e)=>{if(this.STATUSES.error!==e){for(let a in t)if("object"==typeof t[a]&&null!==t[a]){for(let i in t[a])if(t[a][i]===this.STATUSES.undefined)return this.STATUSES.noFullData}else if(t[a]===this.STATUSES.undefined)return this.STATUSES.noFullData}return e})(a,s);let o={city:a.location.city,country:a.location.country,success:""!==s&&this.STATUSES.success===s};return{status:s,...a,...i,...o,date:n}}saveClientData(t){let e=Object.assign(t);e.date=this.getCurrentDate(),this.saveClientDataToLS(e),this.saveClientDataToCookie(e),this.saveClientDataToWindow(e),this.setControlMethods()}saveClientDataToLS(t){localStorage.setItem(this.cache.saveClientKeyName,JSON.stringify(t))}saveClientDataToCookie(t){let e=new Date;e.setDate(e.getDate()+this.cache.relevancePeriod),e.setHours(23,59,59),document.cookie=this.cache.saveClientKeyName+"="+JSON.stringify(t)+";expires="+e.toUTCString()+";path=/"}saveClientDataToWindow(t){window.AdaptyClientData=t}deleteClientData(){this.deleteClientDataInLS(),this.deleteClientDataInCookie(),this.deleteClientDataInWindow()}deleteClientDataInLS(){localStorage.removeItem(this.cache.saveClientKeyName)}deleteClientDataInCookie(){document.cookie=this.cache.saveClientKeyName+"=; expires=Thu, 01 Feb 1996 14:05:00 UTC; path=/;"}deleteClientDataInWindow(){window.AdaptyClientData=null}refreshClientData(){this.deleteClientData(),this.getClientData()}setControlMethods(){window.AdaptyClientData.get=()=>this.getClientData(),window.AdaptyClientData.delete=()=>{this.deleteClientData(),window.AdaptyClientData={},this.setControlMethods()},window.AdaptyClientData.refresh=()=>this.refreshClientData(),window.AdaptyClientData.hasData=()=>this.hasClientData()}getCurrentDate(){let t=new Date,[e,a,i]=[t.getMonth()+1,t.getDate(),t.getFullYear(),],n=e<10?`0${e}`:e,s=a<10?`0${a}`:a;return`${i}-${n}-${s}`}assignData(t,e,a=this.STATUSES.undefined){return t.hasOwnProperty(e)?t[e]:a}dispatchDataReadyEvent(){let t=new CustomEvent("AdaptyClientDataReady",{detail:{message:"Client data is ready"}});document.dispatchEvent(t)}hasClientData(){return!!localStorage.getItem(this.cache.saveClientKeyName)}}const ACD=new AdaptyClientData;